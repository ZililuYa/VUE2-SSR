<template>
  <div>
    <!-- <div class="featurebar">
      <ul class="ul">
        <li class="active"><a href="javascript:;">所有</a></li>
      </ul>
    </div> -->
    <div class="search-main">
      <form class="form-inline">
        <dropdown class="form-group">
          <div class="input-group">
            <input class="form-control" type="text" readonly v-model="param._beginTime" placeholder="开始时间">
            <div class="input-group-btn">
              <btn class="dropdown-toggle"><i class="glyphicon glyphicon-calendar"></i></btn>
            </div>
          </div>
          <template slot="dropdown">
            <li>
              <date-picker v-model="param._beginTime" />
            </li>
          </template>
        </dropdown>
        <dropdown class="form-group">
          <div class="input-group">
            <input class="form-control" type="text" readonly v-model="param._endTime" placeholder="结束时间">
            <div class="input-group-btn">
              <btn class="dropdown-toggle"><i class="glyphicon glyphicon-calendar"></i></btn>
            </div>
          </div>
          <template slot="dropdown">
            <li>
              <date-picker v-model="param._endTime" />
            </li>
          </template>
        </dropdown>
        <btn type="primary" @click="doSearch">搜索</btn>
      </form>
    </div>
    <div class="main">
      <dataTable :tool="tool" :data="logList.data" :page="logList.page" @pageChange="tableChange" :columns="columns"></dataTable>
    </div>
  </div>
</template>
<script>
import { mapGetters, mapActions } from 'vuex'
import dataTable from 'components/table/table.vue'

export default {
  name: 'log',
  title() {
    return '动态'
  },
  data() {
    return {
      param: {
        beginTime: '',
        _beginTime: '',
        endTime: '',
        _endTime: '',
        pageSize: 20,
        pageIndex: 1
      },
      tool: [],
      columns: [{
        type: 'selection'
      }, {
        text: '日期',
        key: 'createTime',
        align: 'center',
        width: 150,
        render: (h, params) => {
          let date = new Date(params.createTime)
          let y = 1900 + date.getYear()
          let m = '0' + (date.getMonth() + 1)
          let d = '0' + date.getDate()
          let dates = y + '-' + m.substring(m.length - 2, m.length) + '-' + d.substring(d.length - 2, d.length)
          return dates
        }
      }, {
        text: '操作者',
        key: 'memberName'
      }, {
        text: '动作',
        key: 'action'
      }, {
        text: 'ID',
        key: 'id',
        width: 100
      }, {
        text: '对象名称',
        key: 'content'
      }]
    }
  },
  computed: {
    ...mapGetters({
      logList: 'logList'
    })
  },
  components: { dataTable },
  asyncData({ store }) {
    return store.dispatch('isLog')
  },
  mounted() {
    console.log('isLog', this.logList)
  },
  methods: {
    ...mapActions([
      'isLog'
    ]),
    doSearch() {
      this.param.beginTime = new Date(this.param._beginTime).getTime()
      this.param.endTime = new Date(this.param._endTime).getTime()
      this.isLog(this.param)
    },
    tableChange: function(data) {
      if (data) this.param.pageIndex = data
      this.isLog(this.param)
    }
  }
}

</script>
<style lang="less">


</style>
