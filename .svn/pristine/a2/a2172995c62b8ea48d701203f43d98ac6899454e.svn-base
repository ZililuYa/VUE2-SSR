<template>
  <div>
    <win-header></win-header>
    <router-view></router-view>
  </div>
</template>
<script lang="babel">
import { mapGetters } from 'vuex'
import WinHeader from 'components/header/Header'

export default {
  data () {
    return { title: '', visible: false }
  },
  computed: {
    ...mapGetters({
      status: 'getUserStatus'
    })
  },
  components: {
    WinHeader
  },
  mounted () {
    // 客户端请求axios
    this.getUserLogin()
  },
  created () {
    // 客户端 服务端同时请求axios
    // this.getUserLogin()
  },
  asyncData ({ store, route, cookies }) {
    // console.log('asyncData=>', cookies || {})
    // 服务端请求axios
    return store.dispatch('getUserStatus')
  },
  methods: {
    getUserLogin () {
      /**
        *判断登录状态
        **/
      let vm = this
      console.log('客户端获取用户', vm.status)
      if (vm.status.code === 200) {
        this.visible = !this.visible
      } else if (vm.status.code === 401) {
        // 未登录
        this.visible = !this.visible
        // this.$router.replace({ path: '/login' })
      } else if (vm.status.code === 403) {
        // 无访问权限
        this.$confirm({
          title: '访问受限',
          okText: '重新登录',
          cancelText: '返回',
          content: '抱歉，您无权访问『首页』模块的『首页』功能。请联系管理员获取权限。'
        }).then(() => {
          this.$router.replace({ path: '/login' })
        }).catch(() => {
          this.$router.replace({ path: '/login' })
        })
      } else {
        this.$notify(vm.status.message)
      }
    }
  }
}

</script>
