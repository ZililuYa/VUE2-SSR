<template>
  <div class="">
    <div class="featurebar">
      <ul class="ul">
        <li>
          <b>团队成员</b>
        </li>
        <li class="fr">
          <router-link to="/project/index"><i class="fa fa-reply"></i></router-link>
        </li>
      </ul>
    </div>
    <div class="search-main" v-show="search">
      <form class="form-inline">
        <div class="form-group input-group-sm">
          <input type="text" class="form-control" id="exampleInputName2" placeholder="请输入搜索关键字">
        </div>
        <button type="button" class="btn btn-primary btn-sm">搜索</button>

        <div class="fr">
          <a href="javascript:;" class="close" @click="search=!search"><i class="fa fa-close"></i></a>
        </div>
      </form>
    </div>
    <div class="main">
      <dataTable :tool="tool" :data="state.data" :page="state.page" @pageChange="tableChange" :columns="columns"></dataTable>
    </div>
  </div>
</template>

<script>
  import { mapGetters, mapActions } from 'vuex'
  import dataTable from '../../../components/table/table.vue'
  import api from 'src/api'

  export default {
    components: {dataTable},
    data () {
      return {
        search: false,
        tool: [{
          text: '删除',
          click: function (data) {
            console.log('要批量删除的数据', data)
          }
        }],
        columns: [{
          type: 'selection'
        }, {
          text: '用户',
          key: 'memberName'
        }, {
          text: '角色',
          key: 'roleName'
        }, {
          text: '加盟日',
          key: 'createTime',
          render: function (h, row) {
            return h('span', {}, new Date(row.createTime).Format('yyyy-MM-dd'))
          }
        }, {
          text: '可用工日',
          key: 'hasTime',
          render: function (h, row) {
            return h('span', {}, new Date(row.hasTime).Format('yyyy-MM-dd'))
          }
        }, {
          text: '可用工时/天',
          key: 'hasTime',
          render: function (h, row) {
            return h('span', {}, new Date(row.hasTime).Format('yyyy-MM-dd'))
          }
        }, {
          text: '总计',
          key: 'hasTime',
          render: function (h, row) {
            return h('span', {}, new Date(row.hasTime).Format('yyyy-MM-dd'))
          }
        }, {
          text: '操作',
          width: 30,
          align: 'center',
          render: (h, row) => {
            return h('btn', {
              attrs: {
                size: 'xs',
                type: 'danger'
              },
              on: {
                click: () => {
                  this.del(row.id)
                }
              }
            }, '删除')
          }
        }],
        param: {
          pageSize: 20,
          pageIndex: 1,
          projectId: parseInt(this.$route.params.id)
        }
      }
    },
    computed: {
      ...mapGetters({
        state: 'projectTeamList'
      })
    },
    mounted () {
      console.log('服务端接收到的数据：', this.state)
    },
    asyncData ({store, route}) {
      return store.dispatch('isProjectTeam', {projectId: parseInt(route.params.id)})
    },
    methods: {
      ...mapActions([
        'isProjectTeam'
      ]),
      tableChange (data) {
        this.param.pageIndex = data
        this.isProjectTeam(this.param)
      },
      del (id) {
        console.log(id)
        this.$confirm({
          title: '提示',
          okText: '确定',
          cancelText: '取消',
          content: '确定要删除吗？'
        }).then(() => {
          api.post('/v1/team/delete', {id}).then((response) => {
            if (response.code === 200) {
              this.isProjectTeam(this.param)
            } else {
              this.$notify(response.message)
            }
          })
        }).catch(() => {
        })
      }
    }
  }
</script>

