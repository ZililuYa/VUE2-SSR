<template>
  <div>
    <textarea :name="'editor'+id" ref="editor" style="width: 100%"></textarea>
  </div>
</template>
<script>
  /**
   * 全局editor
   * */
  export default {
    data () {
      return {
        editor: '',
        fo: false,
        id: parseInt(Math.random() * 9999999)
      }
    },
    components: {},
    mounted () {
      this.init()
    },
    watch: {
      value: function (newData, oldData) {
        if (this.fo) {
          this.fo = false
          return
        }
        if (newData) this.editor.html(newData)
      }
    },
    props: {
      value: String
    },
    methods: {
      init () {
        let main = this
        main.editor = window.KindEditor.create('textarea[name="editor' + main.id + '"]', {
          themeType: 'simple',
          allowFileManager: true,
          afterChange: function () {
            if (main.value) main.fo = true
            main.$emit('input', this.html())
          }
        })
        if (main.value) main.editor.html(main.value)
      }
    }
  }
</script>
