<template>
  <div class="">
    <div class="featurebar">
      <ul class="ul">
        <li id="undoneTab" class="active">
          <a href="javascript:;">编辑用户 {{datas.name}}</a>
        </li>
      </ul>
    </div>
    <div class="main-no-padding">
      <div class="form-content">
        <formData ref="form" class="form-horizontal">
          <!-- <div class="form-group">
            <label for="name" class="col-sm-3 control-label"><span class="text-danger">* </span> 用户名</label>
            <div class="col-sm-9">
              <input type="text" v-model="datas.name" class="form-control" id="name" validate="required">
            </div>
          </div> -->
          <div class="form-group">
            <label for="truename" class="col-sm-3 control-label"> 真实姓名</label>
            <div class="col-sm-9">
              <input type="text" v-model="datas.truename" class="form-control" id="truename">
            </div>
          </div>
          <div class="form-group">
            <label for="email" class="col-sm-3 control-label"> 邮箱</label>
            <div class="col-sm-9">
              <input type="email" v-model="datas.email" class="form-control" id="email" validate="email">
            </div>
          </div>
          <div class="form-group">
            <label for="passwd" class="col-sm-3 control-label"><span class="text-danger">* </span> 密码</label>
            <div class="col-sm-9">
              <input type="password" v-model="datas.passwd" class="form-control" id="passwd" validate="required">
            </div>
          </div>
          <div class="form-group">
            <label for="" class="col-sm-3 control-label"><span class="text-danger">* </span> 所属部门</label>
            <div class="col-sm-9">
              <select class="form-control" v-model="datas.departmentId">
                <option v-for="item in departmentList" :value="item.id">{{item.name}}</option>
              </select>
            </div>
          </div>
          <div class="form-group">
            <label for="" class="col-sm-3 control-label">职位</label>
            <div class="col-sm-9">
              <select class="form-control" v-model="datas.positionId">
                <option v-for="item in jobList.data" :value="item.id">{{item.name}}</option>
              </select>
            </div>
          </div>
          <div class="art-btn-group col-sm-offset-2">
            <btn class="" type="primary" @click="submits">保存</btn>
            <btn class="" @click="doBack">返回</btn>
          </div>
        </formData>
      </div>
    </div>
  </div>
</template>

<script>
import { mapGetters } from 'vuex'
import formData from 'components/form/form.vue'
import api from 'src/api'
import cookies from 'js-cookie'

export default {
  name: 'User',
  title () {
    return '用户编辑'
  },
  data () {
    return {
      datas: {
        name: '',
        truename: '',
        passwd: '',
        departmentId: '',
        positionId: ''
      }
    }
  },
  computed: {
    ...mapGetters({
      getUserDetail: 'getUserDetail',
      departmentList: 'departmentList',  // 部门
      jobList: 'jobList'    // 职位
    })
  },
  components: {formData},
  created () {
  },
  asyncData ({ store, route }) {
    return Promise.all([store.dispatch('isJob'), store.dispatch('isDepartment', {})])
  },
  mounted () {
    // 客户端
    this.cookieUser()
  },
  methods: {
    cookieUser (params) {
      let users = JSON.parse(cookies.get('select_user'))
      this.datas.name = users.member.name
      this.datas.truename = users.member.truename
      this.datas.passwd = users.member.passwd
      this.datas.departmentId = users.departmentId
      this.datas.positionId = users.positionId
      console.log('用户信息all', users)
    },
    submits () {
      /**
        * 验证
       **/
      let validate = this.$refs.form.validate()
      if (validate) {
        this.doSubmit()
      } else {
        return false
      }
    },
    doSubmit () {
      /**
        * 保存提交
       **/
      api.post('/companyUser/update', this.datas).then((response) => {
        if (response.httpCode === 200) {
          this.$notify({
            type: 'success',
            content: '编辑成功'
          })
          this.doBack()
          console.log(response)
        } else {
          this.$notify({
            type: 'danger',
            content: response.message
          })
        }
      }).catch((error) => {
        console.log(error)
      })
    },
    doBack () {
      /**
        * 返回
       **/
      this.$router.replace({ path: '/organization/index' })
    }
  }
}
</script>
<style lang="less">
.form-content {
  width:40%;
  margin:0 auto;
}
</style>
