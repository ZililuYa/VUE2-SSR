<template>
  <div>
    <div class="featurebar">
      <ul class="ul">
        <li class="active">
          <a>添加项目</a>
        </li>
      </ul>
    </div>
    <div class="main">
      <formData ref="form">
        <div class="row">
          <div class="form-group col-lg-12 input-group-sm">
            <label>项目名称</label>
            <input type="text" class="form-control" v-model="item.name" validate="required">
          </div>
          <div class="form-group col-lg-12 input-group-sm">
            <label>项目代号</label>
            <input type="text" class="form-control" v-model="item.code" validate="required">
          </div>
          <div class="form-group col-lg-12 input-group-sm">
            <label>开始时间</label>
            <dropdown class="form-group ">
              <div class="input-group input-group-sm input-group-up">
                <input class="form-control" type="text" v-model="item.startTimeDate" readonly="readonly" validate="required">
                <div class="input-group-btn">
                  <btn class="dropdown-toggle"><i class="glyphicon glyphicon-calendar"></i></btn>
                </div>
              </div>
              <template slot="dropdown">
                <li>
                  <date-picker v-model="item.startTimeDate"/>
                </li>
              </template>
            </dropdown>
          </div>
          <div class="form-group col-lg-12 input-group-sm">
            <label>结束时间</label>
            <dropdown class="form-group">
              <div class="input-group input-group-sm input-group-up">
                <input class="form-control" type="text" v-model="item.endTimeDate" readonly="readonly" validate="required">
                <div class="input-group-btn">
                  <btn class="dropdown-toggle"><i class="glyphicon glyphicon-calendar"></i></btn>
                </div>
              </div>
              <template slot="dropdown">
                <li>
                  <date-picker v-model="item.endTimeDate"/>
                </li>
              </template>
            </dropdown>
          </div>
          <div class="form-group col-lg-12">
            <label>可用工作日</label>
            <div class="input-group input-group-sm input-group-up">
              <input type="text" class="form-control" v-model="item.workDay" validate="required|number">
              <label class="input-group-addon">天</label>
            </div>
          </div>
          <div class="form-group col-lg-12 input-group-sm">
            <label>团队名称</label>
            <input type="text" class="form-control" v-model="item.teamName" validate="required">
          </div>
          <div class="form-group col-lg-12 input-group-sm">
            <label>项目类型</label>
            <select class="form-control" v-model="item.type" validate="required">
              <option v-for="i in typeList.data" :value="i.id">{{i.remark}}</option>
            </select>
          </div>
          <div class="form-group col-lg-12 input-group-sm">
            <label>项目描述</label>
            <!--<textarea type="text" class="form-control" v-model="item.content" validate="required"></textarea>-->
            <editor v-model="item.content"></editor>
          </div>
          <div class="form-group col-lg-12 input-group-sm">
            <label>访问控制</label>
            <p>
              <label class="label-radio">
                <input type="radio" value="1" v-model="item.visitStatus" name="radio">
                默认设置（有项目视图权限，即可访问）
              </label>
            </p>
            <p>
              <label class="label-radio">
                <input type="radio" value="2" v-model="item.visitStatus" name="radio">
                私有项目（只有项目团队成员才能访问）
              </label>
            </p>
            <p>
              <label class="label-radio">
                <input type="radio" value="3" v-model="item.visitStatus" name="radio"> 自定义白名单（团队成员和白名单的成员可以访问）
              </label>
            </p>
          </div>
          <div class="form-group col-lg-12">
            <label></label>
            <button type="button" class="btn btn-primary btn-sm" @click="submit">保存</button>
            <button type="button" class="btn btn-default btn-sm" @click="back">返回</button>
          </div>
        </div>
      </formData>
    </div>
  </div>
</template>

<script>
  import { mapGetters } from 'vuex'
  import formData from '../../../components/form/form.vue'
  import editor from '../../../components/editor/editor.vue'
  import api from 'src/api'

  export default {
    name: 'Project',
    data () {
      return {
        currentPage: 2,
        item: {
          name: '项目的名称',
          visitStatus: '1'
        }
      }
    },
    computed: {
      ...mapGetters({
        typeList: 'projectTypeList'
      })
    },
    components: {formData, editor},
    asyncData ({store}) {
      return store.dispatch('isProjectType', {code: 'PROJECT_TYPE'})
    },
    mounted () {
    },
    methods: {
      back () {
        this.$router.push('/project/index')
      },
      submit () {
        console.log(this.item)
        let fo = this.$refs.form.validate()
        if (!fo) return false
        if (this.item.startTimeDate) this.item.startTime = new Date(this.item.startTimeDate).getTime()
        if (this.item.endTimeDate) this.item.endTime = new Date(this.item.endTimeDate).getTime()
        api.post('/v1/project/insert', this.item).then((response) => {
          if (response.code === 200) {
            this.$alert({
              title: '提示',
              okText: '确定',
              content: '添加成功'
            }).then(() => {
              console.log(response)
              this.$router.push('/project/index')
            })
          } else {
            this.$alert({
              content: response.message
            })
          }
        })
      }
    }
  }
</script>
<style lang="less">
  .form-task .form-group p label {
    width: 100%;
  }

  .label-radio {
    padding-left: 0 !important;
    line-height: inherit !important;
    font-size: 13px !important;
    font-weight: 400 !important;
    cursor: pointer;
    input {
      vertical-align: middle;
      margin-top: -2px;
    }
  }

  .form-control[readonly] {
    background-color: #fff;
  }
  .input-group-up {
    .form-control {
      min-width: 262px !important;
    }
  }
</style>
