<template>
  <div class="art1001">
    <win-header></win-header>
    <router-view></router-view>
  </div>
</template>
<script>
import { mapGetters, mapActions } from 'vuex'
import WinHeader from 'components/header/Header'
// import api from 'src/api/'
import cookies from 'js-cookie'
export default {
  computed: {
    ...mapGetters({
      userStatus: 'getUserStatus'
    })
  },
  asyncData({ store, route, cookies }) {
    // 服务端请求axios
    // return store.dispatch(`doIsLogins`)
  },
  created() {
    // 客户端 服务端同时请求axios
    this.doIsLogins()
  },
  mounted() {
    // 客户端请求axios
    // console.log(1)
    // this.doIsLogins()
    console.log('获取的用户数据cookie', cookies.getJSON('user_db'))
  },
  components: {
    WinHeader
  },
  watch: {
    userStatus(val) {
      this.getUserStatus(val)
    }
  },
  methods: {
    ...mapActions([
      'doIsLogins'
    ]),
    getUserStatus(response) {
      console.log(response.code)
      // 403无权限访问
      if (response && response.code === 403) {
        this.$confirm({
          title: '访问受限',
          okText: '重新登录',
          cancelText: '返回',
          content: '抱歉，您无权访问『首页』模块的『首页』功能。请联系管理员获取权限。'
        }).then(() => {
          this.$router.replace({ path: '/login' })
        }).catch(() => {
          this.$router.replace({ path: '/login' })
        })
      }
    }
  }
}

</script>
