<template>
  <div class="">
    <div class="featurebar">
      <ul class="ul">
        <li class="active"><a href="">未完成</a>
        </li>
        <li><a href="">所有</a>
        </li>
        <li><a href="">已经延期</a>
        </li>
        <li><a href="">需求变动</a>
        </li>
        <li><a href="javascript:;" @click="search=!search"><i class="fa fa-search"></i> 搜索</a></li>
        <li class="fr">
          <a href="javascript:;" @click="add"><i class="fa fa-plus"></i> 建任务</a>
        </li>
      </ul>
    </div>
    <div class="search-main" v-show="search">
      <form class="form-inline">
        <div class="form-group input-group-sm">
          <input type="text" class="form-control" id="exampleInputName2" placeholder="请输入搜索关键字">
        </div>
        <button type="button" class="btn btn-primary btn-sm">搜索</button>

        <div class="fr">
          <a href="javascript:;" class="close" @click="search=!search"><i class="fa fa-close"></i></a>
        </div>
      </form>
    </div>
    <div class="main">
      <dataTable :tool="tool" :data="state.data" :page="state.page" @pageChange="tableChange" :columns="columns"></dataTable>
    </div>
  </div>
</template>

<script>
  import { mapGetters, mapActions } from 'vuex'
  import dataTable from '../../../components/table/table.vue'

  export default {
    components: {dataTable},
    data () {
      return {
        search: false,
        tool: [{
          text: '删除',
          click: function (data) {
            console.log('要批量删除的数据', data)
          }
        }],
        columns: [{
          type: 'selection'
        }, {
          text: '任务名称',
          width: 300,
          render: function (h, row) {
            return h('a', {
              attrs: {
                href: 'javascript:;'
              },
              on: {
                click: () => {
                }
              }
            }, row.name)
          }
        }, {
          text: '状态',
          key: 'status'
        }, {
          text: '截止',
          render: function (h, row) {
            return h('span', {}, new Date(row.endTime).toLocaleString())
          }
        }, {
          text: '指派给',
          key: 'assignedName'
        }, {
          text: '完成者',
          key: 'finishName'
        }, {
          text: '预',
          key: 'estimateTime'
        }, {
          text: '耗时',
          key: 'consumeTime'
        }, {
          text: '剩',
          key: 'surplusTime'
        }, {
          text: '操作'
        }],
        param: {
          pageSize: 20,
          pageIndex: 1,
          projectId: parseInt(this.$route.params.id)
        }
      }
    },
    computed: {
      ...mapGetters({
        state: 'projectTaskList'
      })
    },
    mounted () {
      console.log('服务端接收到的数据：', this.state)
    },
    asyncData ({store, route}) {
      console.log(route)
      store.dispatch('isProjectTask', {projectId: parseInt(route.params.id)})
    },
    methods: {
      ...mapActions([
        'isProjectTask'
      ]),
      add () {
        this.$router.push(this.$route.path + '/add')
      },
      tableChange (data) {
        this.param.pageIndex = data
        this.isProjectTask(this.param)
      }
    }
  }
</script>

<style lang="less">
  .close {
    line-height: 30px;
    font-size: 20px;
  }

  .search-main {
    border-bottom: 1px solid #ddd;
    padding: 10px 20px;
  }

  .row-table {
    display: table;
    width: 100%;
  }

  .col-side, .col-main {
    display: table-cell;
  }

  .col-side {
    width: 350px;
    padding-left: 10px;
  }

  .col-main {
    padding-right: 10px;
  }

  .fieldset {
    margin-bottom: 15px;
    border: 1px solid #e5e5e5;
    padding: 10px 15px 15px;
    legend {
      width: auto;
      margin: 0 0 0 -5px;
      font-size: 13px;
      font-weight: bold;
      border-bottom: 0;
      padding: 0 5px;
    }
    .content {
    }
  }

  .table .pagination {
    margin: 0 !important;
    float: right;
  }

  .totalPage {
    padding-right: 20px;
    font-size: 12px;
    line-height: 30px;
  }

  .check {
    vertical-align: middle;
    margin: -2px 0 0 0 !important;
  }
</style>
