<template>
  <dropdown>
    <div :class="'input-group input-group-up input-group-'+size">
      <input class="form-control" type="text" v-model="inputData" readonly="readonly" :validate="validate">
      <div class="input-group-btn">
        <btn class="dropdown-toggle"><i class="glyphicon glyphicon-calendar"></i></btn>
      </div>
    </div>
    <template slot="dropdown">
      <li>
        <date-picker v-model="dataTime"/>
      </li>
    </template>
  </dropdown>
</template>
<script>
  /**
   * 全局时间输入框
   * */
  export default {
    data () {
      return {
        inputData: '',
        dataTime: ''
      }
    },
    components: {},
    mounted () {
      this.update()
    },
    props: {
      validate: String,
      value: [String, Number],
      size: {
        type: String,
        default: ''
      }
    },
    watch: {
      value: function (newData, oldData) {
        if (newData !== new Date(this.dataTime).getTime()) this.update()
      },
      dataTime: function (newData, oldData) {
        this.inputData = newData
        this.$emit('input', new Date(newData).getTime())
      }
    },
    methods: {
      update () {
        if (this.value) {
          let data = new Date(this.value).Format('yyyy-MM-dd')
          this.inputData = data
          this.dataTime = data
        }
      }
    }
  }
</script>
