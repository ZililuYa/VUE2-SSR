<template>
  <div>
    <div class="featurebar">
      <ul class="ul">
        <li class="active">
          <a>添加项目</a>
        </li>
      </ul>
    </div>
    <div class="main">
      <form class="form-inline form-task">
        <div class="row">
          <div class="form-group col-lg-12 input-group-sm">
            <label>项目名称</label>
            <input type="text" class="form-control" v-model="item.name">
          </div>
          <div class="form-group col-lg-12 input-group-sm">
            <label>项目代号</label>
            <input type="text" class="form-control" v-model="item.code">
          </div>
          <div class="form-group col-lg-12 input-group-sm">
            <label>开始时间</label>
            <dropdown class="form-group ">
              <div class="input-group input-group-sm">
                <input class="form-control" type="text" v-model="item.startTimeDate">
                <div class="input-group-btn">
                  <btn class="dropdown-toggle"><i class="glyphicon glyphicon-calendar"></i></btn>
                </div>
              </div>
              <template slot="dropdown">
                <li>
                  <date-picker v-model="item.startTimeDate"/>
                </li>
              </template>
            </dropdown>
          </div>
          <div class="form-group col-lg-12 input-group-sm">
            <label>结束时间</label>
            <dropdown class="form-group">
              <div class="input-group input-group-sm">
                <input class="form-control" type="text" v-model="item.endTimeDate">
                <div class="input-group-btn">
                  <btn class="dropdown-toggle"><i class="glyphicon glyphicon-calendar"></i></btn>
                </div>
              </div>
              <template slot="dropdown">
                <li>
                  <date-picker v-model="item.endTimeDate"/>
                </li>
              </template>
            </dropdown>
          </div>
          <div class="form-group col-lg-12 input-group-sm">
            <label>可用工作日</label>
            <div class="input-group">
              <input type="text" class="form-control" v-model="item.workDay">
              <label class="input-group-addon">天</label>
            </div>
          </div>
          <div class="form-group col-lg-12 input-group-sm">
            <label>团队名称</label>
            <input type="text" class="form-control" v-model="item.teamName">
          </div>
          <div class="form-group col-lg-12 input-group-sm">
            <label>项目类型</label>
            <select class="form-control" v-model="item.type">
              <option v-for="i in typeList.data" :value="i.id">{{i.remark}}</option>
            </select>
          </div>
          <div class="form-group col-lg-12 input-group-sm">
            <label>项目描述</label>
            <textarea type="text" class="form-control" v-model="item.content"></textarea>
          </div>
          <div class="form-group col-lg-12 input-group-sm">
            <label>访问控制</label>
            <p>
              <label>
                <input type="radio" value="1" v-model="item.visitStatus" name="radio"> 
                默认设置（有项目视图权限，即可访问）
              </label>
            </p>
            <p>
              <label>
                <input type="radio" value="2" v-model="item.visitStatus" name="radio"> 
                私有项目（只有项目团队成员才能访问）
              </label>
            </p>
            <p>
              <label>
                <input type="radio" value="3" v-model="item.visitStatus" name="radio"> 自定义白名单（团队成员和白名单的成员可以访问）
              </label>
            </p>
          </div>
          <div class="form-group col-lg-12">
            <label></label>
            <button type="button" class="btn btn-primary btn-sm" @click="submit">保存</button>
            <button type="button" class="btn btn-default btn-sm">返回</button>
          </div>
        </div>
      </form>
    </div>
  </div>
</template>

<script>
  import { mapGetters } from 'vuex'
  //  import editor from '../../../components/editor/Quilleditor.vue'
  import api from 'src/api'

  export default {
    name: 'Project',
    data () {
      return {
        currentPage: 2,
        item: {
          name: '项目的名称',
          visitStatus: '1'
        }
      }
    },
    computed: {
      ...mapGetters({
        typeList: 'projectTypeList'
      })
    },
//    components: {editor},
    asyncData ({store}) {
      return store.dispatch('isProjectType', {code: 'PROJECT_TYPE'})
    },
    mounted () {
    },
    methods: {
      submit () {
        console.log(this.item)
        if (this.item.startTimeDate) {
          this.item.startTime = new Date(this.item.startTimeDate).getTime()
        }
        if (this.item.endTimeDate) {
          this.item.endTime = new Date(this.item.endTimeDate).getTime()
        }
        api.post('/v1/project/insert', this.item).then((response) => {
          if (response.code === 200) {
//            this.$alert('添加成功, 3秒后跳转到项目列表')
            this.$alert({
              title: '提示',
              okText: '确定',
              content: '添加成功'
            }).then(() => {
              this.$router.push('/project/index')
            })
          } else {
            this.$alert({
              content: response.message
            })
          }
        })
      }
    }
  }
</script>
<style lang="less">
  .form-task .form-group p label{
    width: 100%;
  }
</style>