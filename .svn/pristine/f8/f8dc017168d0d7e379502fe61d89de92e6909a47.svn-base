<template>
    <div class="">
      <div class="invite-wrap">
        <div class="invite-head">
          <div class="pull-left">
            账号邀请
          </div>
          <div class="pull-right">
            <a href="javascript:void(0);" @click="doCodeModal">通过链接邀请</a>
          </div>
        </div>
        <div class="form-group has-feedback invite-search">
          <input type="text" v-model="searchData" class="form-control" placeholder="输入用户账号查找" @blur="doSearch" @keyup.enter="doSearch">
          <span class="glyphicon glyphicon-search form-control-feedback" aria-hidden="true"></span>
        </div>
      </div>
      <div class="invite-result" v-if="startSearch">
        <!-- 搜索结果 -->
        <div class="result" v-if="searchResult">
          <div class="result-item" v-for="item in userList.data">
            <div class="" class="search-avatar">
              <img :src="item.avatar">
            </div>
            <div class="">
              {{item.name}}
            </div>
            <!-- <span>未加入</span> -->
          </div>
        </div>
        <div class="no-result" v-else="searchResult">
          <img :src="imgSearch" class="img-search">
          <div class="txt-search">没有搜索结果</div>
        </div>
      </div>
      <div class="pull-right-footer">
        <btn type="primary" @click="doSubmit">邀请</btn>
        <!-- <btn type="primary">返回</btn> -->
      </div>
    </div>
</template>
<script>
  import { mapGetters, mapActions } from 'vuex'
  import imgSearch from 'assets/images/search.png'
  import api from 'src/api'
  export default {
    data () {
      return {
        imgSearch,
        startSearch: false,
        searchResult: false,
        searchData: '',
        codeModal: false,
        codeImg: ''
      }
    },
    props: {
    },
    computed: {
      ...mapGetters({
        userList: 'getUserList' // 用户查询结果
      })
    },
    methods: {
      ...mapActions([
        'doUserList'
      ]),
      doSearch () {
        /**
         * 搜索
         */
        console.log('搜索')
        let vm = this
        vm.startSearch = true
        vm.doUserList({mobile: vm.searchData.trim()})
        console.log(vm.userList.data)
        if (vm.userList.data && vm.userList.data.length > 0) vm.searchResult = true
      },
      doCodeModal () {
        /**
         * 二维码
         */
        this.$emit('art-code')
      },
      doSubmit () {
        /**
         * 邀请
         */
        let vm = this
        if (!vm.userList.data[0].id) {
          vm.notify('danger', '没有可选择用户')
          return false
        }
        let param = {
          memberId: vm.userList.data[0].id,
          projectId: parseInt(vm.$route.params.id)
        }
        api.post('/v1/project/isAgree', param).then((response) => {
          this.$emit('close-model')
          vm.doClean()
          if (response.code === 200) {
            vm.notify('success', '邀请成功')
          } else {
            vm.notify('danger', response.message)
          }
        }).catch((error) => {
          console.log(error)
        })
      },
      doClean () {
        this.searchData = ''
        this.startSearch = false
      },
      notify(type, content) {
        /**
         * 封装一个弹出消息
         * param {String} type 类型
         * param {String} content 内容
         */
        this.$notify({ type, content, dismissible: false, duration: 1000 })
      }
    }
  }
</script>
<style lang="less">
.invite-wrap {
  .invite-head {
    overflow: hidden;
  }
  .invite-search {
    margin-top:15px;
  }
}
.invite-result {
  padding:15px 0;
  min-height: 80px;
  .img-search {
    display: block;
    max-height: 72px;
    max-width: 72px;
    margin: 0 auto;
  }
  .txt-search {
    margin-top: 20px;
    font-size: 18px;
    text-align: center;
    color: #a6a6a6;
  }
  .result-item {
    div {
      float: left;
      margin-right:15px;
      line-height: 30px;
    }
    .search-avatar {
      width: 30px;
      height:30px;
      border-radius: 50%;
      overflow: hidden;
      img {
        width:100%;
      }
    }
  }
}
.pull-right-footer {
  text-align: right;
}
</style>
